<%= render "layouts/navbar2", user: @user %>
<div class="header"> <button class="btn btn-decor"> <%= link_to "Back to Events / Engagements", event_index_path, class:"back-button" %> </button></div>
<div class="wrapper fadeInDown">
	<div id="formContent">
		<h2 class="active">Edit an Engagement</h2>

		<p>* denotes required fields.<p>
		<p>A capacity of 0 represents "No Limit"</p>
		<%= form_with :method => :PATCH, url:"/point_event/#{@point_event.id}", model: @point_event do |form| %>
			<table class="center-edit">
				<tr>
					<th><%= form.label :name %>*</th>
					<td><%= form.text_field :name, placeholder: "Name" %></td>
				</tr>
				<tr>
					<th><%= form.label :description %></th>
					<td><%= form.text_field :description, placeholder: "Description" %></td>
				</tr>
				<tr>
					<th><%= form.label :points %>*</th>
					<td><%= form.number_field :points, placeholder: "Points" %></td>
				</tr>
				<tr>
					<th><%= form.label :capacity %>*</th>
					<td><%= form.number_field :capacity, placeholder: "Capacity" %></td>
				</tr>
			</table>

			<%= form.submit "Save Changes to Engagement" %>
		<% end %>
	</div>

	<h1>Users that planned to attend</h1>
	<table>
		<tr>
			<th>First Name</th>
			<th>Last Name</th>
			<th>Email</th>
			<th>Time Signed Up</th>
			<th>Time Attended</th>
			<th>Action</th>
		</tr>

		<% @point_event.users.each do |user| %>
		<tr>
			<td><%= user.firstName %></td>
			<td><%= user.lastName %></td>
			<td><%= user.email %></td>

			<% attendance = PointEventAttendee.find_by(user_id: user.id, point_event_id: @point_event.id) %>
			<td><%= Event.display_date_time(attendance.created_at) %>
			<td><%= attendance.created_at != attendance.updated_at ? Event.display_date_time(attendance.updated_at) : "N/A" %>
			
			<td><%= link_to "Remove", delete_user_point_event_path(id: @point_event.id, user_id: user.id), method: :delete, data: {confirm: "Are you sure you want to remove \"#{user.firstName} #{user.lastName}\"? \nOnce removed, the user will have to attend the points event again. Points that student received from this points event will also dissappear!"} %></td>
		</tr>
		<% end %>
	</table>
</div>
