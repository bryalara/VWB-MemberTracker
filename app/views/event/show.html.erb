<%= render "layouts/navbar2", user: @user %>
<div class="header">
<h2 class="active h2-title">Event Details</h2>
</div>

<button class="btn align-center" style="margin-left: 20px;">
<%= link_to "Back to Events / Engagements", event_index_path, class: "back-button" %>
</button>
<%= render "form", event: @event %>
<% unless admin?%>
	<%unless EventAttendee.find_by(user_id: @auth.id, event_id: @event.id)%>
		You have not signed up or attended this event.
	<%else%>
		Your uploaded documents: 
		<% EventAttendee.find_by(user_id: @auth.id, event_id: @event.id)&.documents&.each do |file| %>
			<li><%= link_to file.filename, rails_blob_path(file) %></li>
		<% end %>
		<%= form_with :method => :POST, url:"/event/#{@event.id}/upload_user" do |form| %>
			<%= form.file_field :documents, multiple: true, direct_upload: true %>
			<%= hidden_field_tag "user_id", "#{@auth.id}" %>
			<%= hidden_field_tag "event_id", "#{@event.id}" %>
			<% if EventAttendee.find_by(user_id: @auth.id, event_id: @event.id)&.documents&.attached? %>
				<%= form.submit "Submit", data: {confirm: "Are you sure you want to reupload files? Reuploading files will remove previous submissions."}%>
			<%else%>
				<%= form.submit "Submit" %>
			<%end%>
		<%end%>
	<%end%>
<% end %>

<% if admin? %>
<h1>Attendance</h1>
	<table>
		<tr>
			<th>First Name</th>
			<th>Last Name</th>
			<th>Email</th>
			<th>Time Signed Up</th>
			<th>Time Attended</th>
		</tr>

		<% @event.users.each do |user| %>
		<tr>
			<td><%= user.firstName %></td>
			<td><%= user.lastName %></td>
			<td><%= user.email %></td>

			<% attendance = EventAttendee.find_by(user_id: user.id, event_id: @event.id) %>
			<td><%= Event.display_date_time(attendance.created_at) %>
			<td><%= attendance.attended ? Event.display_date_time(attendance.updated_at) : "N/A" %>
		</tr>
		<% end %>
	</table>
<% end %>
